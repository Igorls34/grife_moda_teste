<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Coleções — Grife Moda</title>
  <link rel="stylesheet" href="./css/style.css" />
</head>
<body>
  <header class="site-header">
    <div class="container">
      <a class="brand" href="./index.html">
        <img src="./assets/logo.web" width="32" height="32" alt="Logo Grife Moda">
        <span>Grife Moda</span>
      </a>

      <nav class="site-nav" aria-label="Navegação principal">
        <button class="nav-toggle" aria-expanded="false" aria-controls="menu">Menu</button>
        <ul id="menu" class="menu">
          <li><a href="./index.html#home">Início</a></li>
          <li><a href="./colecoes.html" aria-current="page">Coleções</a></li>
          <li><a href="./index.html#contato">Contato</a></li>
        </ul>
      </nav>

      <div class="cta-row">
        <a class="btn btn-primary" href="./index.html#produtos">Ver novidades</a>
        <button class="btn btn-accent" id="cta-wpp-top" type="button">Comprar no WhatsApp</button>
      </div>
    </div>
  </header>

  <main class="container" style="padding:24px 16px">
    <h1>Coleções</h1>
    <p class="muted">Explore por tipo de peça.</p>

    <div class="cta-row" id="filters" role="tablist" aria-label="Filtros de coleção" style="margin:12px 0">
      <!-- filtros gerados por JS -->
    </div>

    <div id="grid-colecoes" class="grid" aria-live="polite" aria-busy="false"></div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>© Grife Moda — Volta Redonda/RJ</p>
    </div>
  </footer>

  <!-- Carrega utilidades e PRODUCTS -->
  <script src="./js/main.js"></script>
  <script>
    // Usa funções globais definidas em main.js:
    // - window.PRODUCTS
    // - fmtBRL / escapeHtml / cardImgHTML / openWhats / BUSINESS

    (function () {
      const CATS = ["Todos","Camisetas","Camisas","Calças","Bermudas","Moletons","Jaquetas","Acessórios"];
      const grid = document.getElementById("grid-colecoes");
      const filters = document.getElementById("filters");

      // Fallbacks seguros
      const fmtPriceSafe = (val) =>
        typeof val === "number" && Number.isFinite(val) ? fmtBRL(val) : "Sob consulta";

      function getCategory(p){
        const n = String(p.name || "").toLowerCase();
        if (n.includes("camiseta")) return "Camisetas";
        if (n.includes("camisa"))   return "Camisas";
        if (n.includes("moletom"))  return "Moletons";
        if (n.includes("jaqueta"))  return "Jaquetas";
        if (n.includes("bermuda"))  return "Bermudas";
        if (n.includes("calça") || n.includes("calca") || n.includes("jogger")) return "Calças";
        return "Acessórios";
      }

      function render(cat = "Todos"){
        const list = Array.isArray(window.PRODUCTS) ? window.PRODUCTS : [];
        grid.setAttribute("aria-busy", "true");
        grid.innerHTML = "";

        const filtered = list.filter(p => cat === "Todos" ? true : getCategory(p) === cat);

        if (!filtered.length) {
          const empty = document.createElement("div");
          empty.className = "empty";
          empty.innerHTML = `
            <div class="card">
              <div class="card-body">
                <h3 class="title">Nada por aqui (ainda)</h3>
                <p class="muted">Não encontramos itens para <strong>${escapeHtml(cat)}</strong>. Tente outro filtro.</p>
              </div>
            </div>
          `;
          grid.appendChild(empty);
          grid.setAttribute("aria-busy", "false");
          return;
        }

        const frag = document.createDocumentFragment();

        filtered.forEach((p) => {
          const card = document.createElement("article");
          card.className = "card";

          // Usa cardImgHTML se p.imageBase existir; senão cai em p.image
          const imgHTML = (typeof cardImgHTML === "function")
            ? cardImgHTML(p)
            : `<img src="${p.image}" alt="${escapeHtml(p.name || "Produto")}" loading="lazy">`;

          card.innerHTML = `
            ${imgHTML}
            <div class="card-body">
              ${p.highlight ? '<span class="badge">Destaque</span>' : ""}
              <h3 class="title">${escapeHtml(p.name || "Produto")}</h3>
              <div class="price">${fmtPriceSafe(p.price)}</div>
              <div class="muted">Tamanhos: ${Array.isArray(p.sizes) && p.sizes.length ? p.sizes.join(", ") : "-"}</div>
              <div class="cta-row" style="margin-top:10px">
                <a class="btn" href="./produto.html?sku=${encodeURIComponent(p.sku || "")}">Detalhes</a>
                <button class="btn btn-accent js-buy" type="button">Comprar no WhatsApp</button>
              </div>
            </div>
          `;

          // Listener de compra (sem inline JS)
          const btn = card.querySelector(".js-buy");
          btn.addEventListener("click", () => {
            const payload = {
              nome: p.name,
              cor: p.color || "-",
              tamanho: (Array.isArray(p.sizes) && p.sizes[0]) ? p.sizes[0] : "-",
              preco: p.price,
              url: `${BUSINESS.baseUrl}/produto.html?sku=${encodeURIComponent(p.sku || "")}`,
              campaign: "produto",
              content: `colecoes_${p.sku || "s/sku"}`
            };
            openWhats(payload);
          });

          frag.appendChild(card);
        });

        grid.appendChild(frag);
        grid.setAttribute("aria-busy", "false");
      }

      // Filtros com estado ativo + acessível
      function buildFilters(){
        filters.innerHTML = "";
        CATS.forEach((c, idx) => {
          const b = document.createElement("button");
          b.className = "btn";
          b.setAttribute("role", "tab");
          b.setAttribute("aria-selected", idx === 0 ? "true" : "false");
          b.textContent = c;
          b.addEventListener("click", () => {
            // marca ativo
            [...filters.children].forEach(el => el.setAttribute("aria-selected", "false"));
            b.setAttribute("aria-selected", "true");
            render(c);
          });
          filters.appendChild(b);
        });
      }

      buildFilters();
      render("Todos");
    })();
  </script>
</body>
</html>
